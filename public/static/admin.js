"use strict";(()=>{function p(){let t=document.getElementById("sidebar");document.querySelectorAll(".menu-toggle").forEach(o=>{o.addEventListener("click",()=>{t?.classList.toggle("open")})}),document.addEventListener("click",o=>{let i=o.target;!(t?.contains(i)||i.classList.contains("menu-toggle"))&&t?.classList.contains("open")&&window.innerWidth<=768&&t.classList.remove("open")});let n=document.getElementById("logout-btn");n&&n.addEventListener("click",async()=>{if(confirm("\xBFCerrar sesi\xF3n?"))try{await fetch("/api/logout",{method:"POST"}),window.location.href="/login"}catch(o){console.error("Logout failed",o),alert("Error al cerrar sesi\xF3n")}})}function E(){let t=document.getElementById("dropZone");if(!t)return;let e=document.getElementById("mediaGrid");e&&e.addEventListener("click",async o=>{let i=o.target,a=i.closest(".media-action-btn:not(.delete)");if(a){let l=a.dataset.url;l&&T(l)}let r=i.closest(".media-action-btn.delete");if(r){let l=r.dataset.key;l&&I(l,r)}});let n=document.getElementById("fileInput");t&&n&&(t.addEventListener("click",()=>n.click()),t.addEventListener("dragover",o=>{o.preventDefault(),t.style.borderColor="#8b5cf6",t.style.background="#f5f3ff"}),t.addEventListener("dragleave",o=>{o.preventDefault(),t.style.borderColor="#cbd5e1",t.style.background="#f8fafc"}),t.addEventListener("drop",o=>{o.preventDefault(),t.style.borderColor="#cbd5e1",t.style.background="#f8fafc",o.dataTransfer?.files.length&&y(o.dataTransfer.files,t)}),n.addEventListener("change",o=>{let i=o.target;i.files?.length&&y(i.files,t)}))}function T(t){let e=window.location.origin+t;navigator.clipboard.writeText(e).then(()=>{d("URL copiada al portapapeles")})}function d(t){let e=document.getElementById("toast");e&&(e.textContent=t,e.style.display="block",setTimeout(()=>{e.style.display="none"},3e3))}async function I(t,e){if(confirm("\xBFEst\xE1s seguro de eliminar este archivo? Esta acci\xF3n no se puede deshacer."))try{(await fetch("/admin/media/"+encodeURIComponent(t),{method:"DELETE"})).ok?(d("Archivo eliminado"),e.closest(".media-item")?.remove()):d("Error al eliminar archivo")}catch(n){console.error(n),d("Error de conexi\xF3n")}}async function y(t,e){let n=e.querySelector("h3"),o=n?n.textContent:"";n&&(n.textContent="Subiendo "+t.length+" archivo(s)...");let i=0;for(let a=0;a<t.length;a++){let r=new FormData;r.append("file",t[a]);try{(await fetch("/admin/upload",{method:"POST",body:r})).ok&&i++}catch(l){console.error("Error uploading:",l)}}d(i+" archivo(s) subido(s) con \xE9xito"),n&&(n.textContent=o),setTimeout(()=>window.location.reload(),1e3)}function b(){if(!document.getElementById("editor"))return;if(typeof Quill<"u"){let a=new Quill("#editor",{theme:"snow",modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],["blockquote","code-block"],[{list:"ordered"},{list:"bullet"}],[{color:[]},{background:[]}],["link","image","video"],["clean"]]}});a.getModule("toolbar").addHandler("image",()=>v(a));let l=document.getElementById("postForm");l&&(l.onsubmit=function(){let s=document.getElementById("contentInput");s&&(s.value=a.root.innerHTML)})}let e=document.getElementById("imageUpload");e&&e.addEventListener("change",async a=>{let r=a.target;if(r.files&&r.files[0]){let l=r.files[0],s=new FormData;s.append("file",l);let c=document.querySelector('label[for="imageUpload"]'),m="";c&&(m=c.innerHTML,c.innerHTML='<i class="fas fa-spinner fa-spin"></i> Subiendo...');try{let f=await(await fetch("/admin/upload",{method:"POST",body:s})).json();if(c&&(c.innerHTML=m),f.url){let g=document.getElementById("imageUrlInput");g&&(g.value=f.url)}else alert("Error uploading image")}catch(u){console.error(u),c&&(c.innerHTML=m),alert("Error uploading image")}}});let n=document.getElementById("scheduledAtLocalInput"),o=document.getElementById("scheduledAtHiddenInput"),i=document.getElementById("publishBtn");if(n&&o&&i){if(o.value){let a=o.value;!a.endsWith("Z")&&!a.includes("+")&&(a+="Z");try{let r=new Date(a);if(!isNaN(r.getTime())){let l=r.getTimezoneOffset()*6e4,s=new Date(r.getTime()-l).toISOString().slice(0,16);n.value=s,L(n,i)}}catch(r){console.error("Error parsing date:",r)}}n.addEventListener("change",()=>{if(n.value){let l=new Date(n.value).toISOString().replace("T"," ").slice(0,19);o.value=l}else o.value="";L(n,i)})}}function v(t){let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.click(),e.onchange=async()=>{let n=e.files?.[0];n&&h(n,t)}}async function h(t,e){let n=new FormData;n.append("file",t);try{let i=await(await fetch("/admin/upload",{method:"POST",body:n})).json();if(i.url){let a=e.getSelection();e.insertEmbed(a.index,"image",i.url)}else alert("Error uploading image")}catch(o){console.error(o),alert("Error uploading image")}}function L(t,e){t.value&&new Date(t.value)>new Date?(e.innerHTML='<i class="fas fa-clock"></i> Programar Publicaci\xF3n',e.classList.remove("btn-primary"),e.classList.add("btn-warning"),e.style.backgroundColor="#f59e0b",e.style.borderColor="#d97706",e.style.color="white"):(e.innerHTML='<i class="fas fa-paper-plane"></i> Publicar Cambios',e.className="btn btn-primary btn-lg",e.style.backgroundColor="",e.style.borderColor="",e.style.color="")}console.log("Admin Client Loaded");document.addEventListener("DOMContentLoaded",()=>{p(),E(),b()});})();
//# sourceMappingURL=admin.js.map
