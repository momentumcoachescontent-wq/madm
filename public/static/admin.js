"use strict";(()=>{function p(){let t=document.getElementById("sidebar");document.querySelectorAll(".menu-toggle").forEach(n=>{n.addEventListener("click",()=>{t?.classList.toggle("open")})}),document.addEventListener("click",n=>{let r=n.target;!(t?.contains(r)||r.classList.contains("menu-toggle"))&&t?.classList.contains("open")&&window.innerWidth<=768&&t.classList.remove("open")});let o=document.getElementById("logout-btn");o&&o.addEventListener("click",async()=>{if(confirm("\xBFCerrar sesi\xF3n?"))try{let n=await fetch("/api/logout",{method:"POST"});n.ok?window.location.href="/login":(console.error("Logout failed",n.status),alert("Error al cerrar sesi\xF3n"))}catch(n){console.error("Logout failed",n),alert("Error al cerrar sesi\xF3n")}})}function E(){let t=document.getElementById("dropZone");if(!t)return;let e=document.getElementById("mediaGrid");e&&e.addEventListener("click",async n=>{let r=n.target,a=r.closest(".copy-btn");if(a){let s=a.dataset.url;s&&T(s)}let i=r.closest(".media-action-btn.delete");if(i){let s=i.dataset.key;s&&I(s,i)}});let o=document.getElementById("fileInput");t&&o&&(t.addEventListener("click",()=>o.click()),t.addEventListener("dragover",n=>{n.preventDefault(),t.style.borderColor="#8b5cf6",t.style.background="#f5f3ff"}),t.addEventListener("dragleave",n=>{n.preventDefault(),t.style.borderColor="#cbd5e1",t.style.background="#f8fafc"}),t.addEventListener("drop",n=>{n.preventDefault(),t.style.borderColor="#cbd5e1",t.style.background="#f8fafc",n.dataTransfer?.files.length&&y(n.dataTransfer.files,t)}),o.addEventListener("change",n=>{let r=n.target;r.files?.length&&y(r.files,t)}))}function T(t){let e=window.location.origin+t;navigator.clipboard.writeText(e).then(()=>{d("URL copiada al portapapeles")})}function d(t){let e=document.getElementById("toast");e&&(e.textContent=t,e.style.display="block",setTimeout(()=>{e.style.display="none"},3e3))}async function I(t,e){if(confirm("\xBFEst\xE1s seguro de eliminar este archivo? Esta acci\xF3n no se puede deshacer."))try{(await fetch("/admin/media/"+encodeURIComponent(t),{method:"DELETE"})).ok?(d("Archivo eliminado"),e.closest(".media-item")?.remove()):d("Error al eliminar archivo")}catch(o){console.error(o),d("Error de conexi\xF3n")}}async function y(t,e){let o=e.querySelector("h3"),n=o?o.textContent:"";o&&(o.textContent="Subiendo "+t.length+" archivo(s)...");let r=0;for(let a=0;a<t.length;a++){let i=new FormData;i.append("file",t[a]);try{(await fetch("/admin/upload",{method:"POST",body:i})).ok&&r++}catch(s){console.error("Error uploading:",s)}}d(r+" archivo(s) subido(s) con \xE9xito"),o&&(o.textContent=n),setTimeout(()=>window.location.reload(),1e3)}function b(){if(!document.getElementById("editor"))return;if(typeof Quill<"u"){let a=new Quill("#editor",{theme:"snow",modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],["blockquote","code-block"],[{list:"ordered"},{list:"bullet"}],[{color:[]},{background:[]}],["link","image","video"],["clean"]]}});a.getModule("toolbar").addHandler("image",()=>v(a));let s=document.getElementById("postForm");s&&(s.onsubmit=function(){let l=document.getElementById("contentInput");l&&(l.value=a.root.innerHTML)})}let e=document.getElementById("imageUpload");e&&e.addEventListener("change",async a=>{let i=a.target;if(i.files&&i.files[0]){let s=i.files[0],l=new FormData;l.append("file",s);let c=document.querySelector('label[for="imageUpload"]'),m="";c&&(m=c.innerHTML,c.innerHTML='<i class="fas fa-spinner fa-spin"></i> Subiendo...');try{let f=await(await fetch("/admin/upload",{method:"POST",body:l})).json();if(c&&(c.innerHTML=m),f.url){let g=document.getElementById("imageUrlInput");g&&(g.value=f.url)}else alert("Error uploading image")}catch(u){console.error(u),c&&(c.innerHTML=m),alert("Error uploading image")}}});let o=document.getElementById("scheduledAtLocalInput"),n=document.getElementById("scheduledAtHiddenInput"),r=document.getElementById("publishBtn");if(o&&n&&r){if(n.value){let a=n.value;!a.endsWith("Z")&&!a.includes("+")&&(a+="Z");try{let i=new Date(a);if(!isNaN(i.getTime())){let s=i.getTimezoneOffset()*6e4,l=new Date(i.getTime()-s).toISOString().slice(0,16);o.value=l,L(o,r)}}catch(i){console.error("Error parsing date:",i)}}o.addEventListener("change",()=>{if(o.value){let s=new Date(o.value).toISOString().replace("T"," ").slice(0,19);n.value=s}else n.value="";L(o,r)})}}function v(t){let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.click(),e.onchange=async()=>{let o=e.files?.[0];o&&h(o,t)}}async function h(t,e){let o=new FormData;o.append("file",t);try{let r=await(await fetch("/admin/upload",{method:"POST",body:o})).json();if(r.url){let a=e.getSelection();e.insertEmbed(a.index,"image",r.url)}else alert("Error uploading image")}catch(n){console.error(n),alert("Error uploading image")}}function L(t,e){t.value&&new Date(t.value)>new Date?(e.innerHTML='<i class="fas fa-clock"></i> Programar Publicaci\xF3n',e.classList.remove("btn-primary"),e.classList.add("btn-warning"),e.style.backgroundColor="#f59e0b",e.style.borderColor="#d97706",e.style.color="white"):(e.innerHTML='<i class="fas fa-paper-plane"></i> Publicar Cambios',e.className="btn btn-primary btn-lg",e.style.backgroundColor="",e.style.borderColor="",e.style.color="")}console.log("Admin Client Loaded");document.addEventListener("DOMContentLoaded",()=>{p(),E(),b()});})();
//# sourceMappingURL=admin.js.map
